#!/usr/bin/python3
"""
Systeem bijwerken.

Dit script voert een update uit voor op Debian gebaseerde systemen.
"""
###############################################################################
# Systeem bijwerken.
#
# Geschreven door Karel Zimmer <info@karelzimmer.nl>.
###############################################################################

import sys
import kz_common
import subprocess


###############################################################################
# Variables
###############################################################################

program_name = 'kz-update'
display_name = program_name.replace('kz-', 'kz ')
release_year = 2021
desc = 'Systeem bijwerken.'


###############################################################################
# Functions
###############################################################################

def perform_update():
    subprocess.run('sudo true', shell=True, check=True)

    print(f'Uitvoeren apt update...')
    subprocess.run('sudo apt-get update', shell=True, check=True)
    print(f'\nUitvoeren apt upgrade...')
    subprocess.run('sudo apt-get upgrade --yes', shell=True, check=True)
    print(f'\nUitvoeren apt autoremove...')
    subprocess.run('sudo apt-get autoremove --yes', shell=True, check=True)

    # Heeft dit systeem snaps?
    try:
        print(f'\nUitvoeren snap refresh...')
        subprocess.run('sudo snap refresh', shell=True)
    except Exception as ex:
        print(ex)

    # Is een reboot nodig?
    try:
        with open('/var/run/reboot-required') as fh:
            print(f'\nDe computer moet herstarten om het installeren van \
updates af te ronden.')
    except FileNotFoundError:
        pass
    except Exception as ex:
        print(ex)
        sys.exit(1)


###############################################################################
# Script
###############################################################################

kz_common.process_common_options(desc, display_name)

perform_update()
